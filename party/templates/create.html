{% extends 'party_base.html' %}

{% block contents %}
<div class="content height-auto">
    <section class="add">
        <header>
            <a href="javascript:history.back()">
                <i class="fas fa-arrow-left"></i>
            </a>
        </header>
        <div class="add-box">
            <div class="add-title">
                <h3>언제 어디서 만나나요?</h3>
            </div>

            <form action="/api/party/" method="post" onsubmit="return false">
                {% csrf_token %}
                <input type="hidden" name="host" value="{{user_id}}" />
                <div class="add-select">
                    <!-- 제목 -->
                    <div class="add-option">
                        <div class="option-title">
                            <i class="fas fa-edit"></i>
                            <h3>모임 이름, 설명</h3>
                        </div>
                        <div class="input-option active">
                            <input type="text" name="name" placeholder="모임 이름" />
                            <input type="text" name="detail" placeholder="모임 설명" />
                        </div>
                    </div>
                    <!-- 날짜 -->
                    <div class="add-option add-option--date">
                        <div class="option-title">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>날짜 선택</h3>
                        </div>
                        <a class="open-option"><i class="fas fa-caret-down"></i></a>
                        <div class="input-option">
                            <input type="date" name="date" />
                        </div>
                    </div>
                    <!-- 시간 -->
                    <div class="add-option add-option--time">
                        <div class="option-title">
                            <i class="fas fa-clock"></i>
                            <h3>시간 입력</h3>
                        </div>
                        <a class="open-option"><i class="fas fa-caret-down"></i></a>
                        <div class="input-option">
                            <input type="time" name="time" />
                        </div>
                    </div>
                    <!-- 장소 -->
                    <div class="add-option add-option--location">
                        <div class="option-title">
                            <i class="fas fa-map-marker-alt"></i>
                            <h3>장소 입력</h3>
                        </div>
                        <a class="open-option" onclick="set_defaul_address()"><i class="fas fa-caret-down"></i></a>
                        <div class="input-option">
                            <div class="onoffline">
                                <a class="btn-offline active">오프라인</a>
                                <a class="btn-online">온라인</a>
                            </div>
                            <div class="offline">
                                <div class="address-box">
                                    <input type="text" name="address" class="input-address" value=""
                                        onkeypress="if(event.keyCode==13) {search_address()}" />
                                    <a class="openMap"><i class="fas fa-search"></i></a>
                                </div>
                                <div id="map" style="width:100%;height:350px;"></div>
                            </div>
                        </div>
                    </div>
                    <!-- 인원 수 -->
                    <div class="add-option add-option--people">
                        <div class="option-title">
                            <i class="fas fa-users"></i>
                            <h3>인원 설정 <span>(본인 제외)</span></h3>
                        </div>
                        <a class="open-option"><i class="fas fa-caret-down"></i></a>
                        <div class="input-option">
                            <input type="number" name="headcount" value="1" min="1" />
                        </div>
                    </div>
                    <!-- 인원 수 -->
                    <div class="add-option">
                        <div class="option-title">
                            <i class="fas fa-coins"></i>
                            <h3>참가 비용</h3>
                        </div>
                        <a class="open-option"><i class="fas fa-caret-down"></i></a>
                        <div class="input-option">
                            <input type="number" name="price" value="0" min="0" />
                        </div>
                    </div>
                    <!-- 오픈채팅방 링크 -->
                    <div class="add-option add-option--link">
                        <div class="option-title">
                            <i class="fas fa-comment"></i>
                            <h3>오픈채팅방 링크</h3>
                        </div>
                        <a class="open-option"><i class="fas fa-caret-down"></i></a>
                        <div class="input-option">
                            <input type="text" name="link" value="http://billim.co.kr" />
                        </div>
                    </div>
                </div>
                <div class="empty-box"></div>

                <input type="submit" value="만들기" />
            </form>
        </div>
        <div class="bottom-nav">
            <a href="/party"><i class="fas fa-users"></i></a>
            <a href="/party/create"><i class="fas fa-plus-circle"></i></a>
            <a href="/user/profile"><i class="fas fa-user"></i></a>
        </div>
    </section>
</div>
{%endblock%}

{%block extrascript %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script type="text/javascript">
    $(".login-btn").click(function () {
        location.href = "./profile.html";
    });
    $(".open-option").click(function () {
        if ($(this).next().hasClass("active") == 0) {
            $(this).children(".fas:eq(0)").attr("class", "fas fa-caret-up");
        } else {
            $(this).children(".fas:eq(0)").attr("class", "fas fa-caret-down ");
        }
        $(this).next().toggleClass("active");
    });

    $('.onoffline a').click(function () {
        $('.onoffline a').removeClass('active');
        $(this).addClass('active');
    });

    if ($('.btn-online').hasClass('active') == true) {
        $('#map').css('display', 'none')
    }
</script>

<script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7d9f642e7d11cd6aeacaeed86fe5d852&libraries=services">
</script>


<script>
    function set_defaul_address(){
        console.log("test");
        setTimeout(() => search_address('한양대학교 서울캠퍼스'), 50);
        //search_address('한양대학교 서울캠퍼스');
    }

    function search_address(default_address) {
        if(default_address){
            var address = default_address;
        }else{
            var address = $('.input-address').val();
        }
        console.log(address);

        // 마커를 클릭하면 장소명을 표출할 인포윈도우 입니다
        var infowindow = new kakao.maps.InfoWindow({zIndex: 1});

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };
        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
        var ps = new kakao.maps.services.Places(); // 장소 검색 객체를 생성합니다
        ps.keywordSearch(address, placesSearchCB); // 키워드로 장소를 검색합니다

        // 키워드 검색 완료 시 호출되는 콜백함수 입니다
        function placesSearchCB(data, status, pagination) {
            console.log(status);
            if (status === kakao.maps.services.Status.OK) {
                // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                // LatLngBounds 객체에 좌표를 추가합니다
                var bounds = new kakao.maps.LatLngBounds();
                for (var i = 0; i < data.length; i++) {
                    displayMarker(data[i]);
                    bounds.extend(new kakao.maps.LatLng(data[i].y,
                        data[i].x));
                } // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다 
                map.setBounds(bounds);
            } else {
                console.log("error 발생");
            }
        } 
        
        // 지도에 마커를 표시하는 함수입니다 
        function displayMarker(place) { // 마커를 생성하고 지도에 표시합니다 
            var marker = new
            kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x)
            }); // 마커에 클릭이벤트를 등록합니다
            kakao.maps.event.addListener(marker, 'click', function () { // 마커를 클릭하면 장소명이 인포윈도우에 표출됩니다
                infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place
                    .place_name +
                    '</div>');
                infowindow.open(map, marker);
            });
        }
    }
</script>
{%endblock%}