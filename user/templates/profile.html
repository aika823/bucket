{% extends 'base.html' %}

{% block contents %}
<div class="content">
    <section class="profile">
        <div class="profile-box">

            <div class="profile-header">
                {% if my %}
                <h1>내 프로필</h1>
                {%else%}
                <h1>{{user.name}}님의 프로필</h1>
                {%endif%}
                <i class="fas fa-bell"></i>
            </div>

            {# 프로필 사진 #}
            <div class="profile-img">

                {%if my%}
                <img id="profileImage" src="/media/{{user.image}}" alt="profile image" onclick="open_image_input()" />
                <form action="/user/update/" id="imageForm" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" name="image" id="imageInput" style="display: none" />
                </form>
                {%else%}
                <img id="profileImage" src="/media/{{user.image}}" alt="profile image" />
                {%endif%}

                <h3>{{user.name}}</h3>
            </div>

            {# 개인 정보 #}

            {%if my%}
            <form action="/user/update/" method="post">
                {%csrf_token%}
                <input type="text" name="name" value="{{user.name}}">
                <input type="text" name="detail" value="{{user.detail}}">
                <input type="submit" value="수정">
            </form>
            {%else%}
            <div class="profile-description">
                <h3>{{user.name}}</h3>
                <p>{{user.detail}}</p>
            </div>
            {%endif%}

            {# 관심사 #}
            <div class="profile-tag">
                <form action="/api/interest/" , method="post">
                    <input type="text" name="interest" />
                    <input type="submit" value="관심사 추가하기" />
                </form>
                {% for interest in user_interest %}
                <span>#{{interest.interest_id.interest}}</span>
                {% endfor %}
            </div>

            <div>
                {%if user.is_admin%}
                <button onclick="location.href='/manager'">관리자 페이지로 이동</button>
                {%endif%}
            </div>

        </div>{#profile-box#}





        <img class="img-vertical" src="/static/images/logo_vertical.png" alt="" />
        <div class="bottom-nav">
            <a href="/party"><i class="fas fa-users"></i></a>
            <a href="/party/create"><i class="fas fa-plus-circle"></i></a>
            <a href="/user/profile"><i class="fas fa-user"></i></a>
        </div>
    </section>
</div>
{% endblock %}

{% block extrascripts %}
<script type="text/javascript">
    function open_image_input() {
        document.getElementById("imageInput").click();
    }

    imageInput.onchange = evt => {
        const [file] = imageInput.files
        if (file) {
            profileImage.src = URL.createObjectURL(file)
        }
    }

    $('#imageInput').on('change', function () {
        console.log($(this).val)
        $('#imageForm').submit();
    })
</script>
{% endblock %}